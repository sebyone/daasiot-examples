openapi: "3.0.3"
info:
  title: daasiot-dccs
  version: "1.2.1"

  contact:
    name: API Support
    email: a.farfaglia@sebyone.it

  license:
    name: MPL-2.0
    url: https://www.mozilla.org/en-US/MPL/2.0/

servers:
  - url: http://localhost:{port}/api
    description: Development server
    variables:
      port:
        default: "3000"
        description: default port for the development server

externalDocs:
  url: "https://github.com/sebyone/daasiot-examples-dccs"

tags:
  - name: configuration
    description: API per la configurazione del nodo daas
  - name: lifecycle
    description: API per gestire il del ciclo di vita del nodo daas (avvio, stop, riavvio)
  - name: commands
    description: API per l'invio di comandi ai nodi daas, come invio di messaggi
  - name: receivers
    description: API per la gestione dei receivers, nodi locali che ricevono e potenzialmente inviano messaggi
  - name: remotes
    description: API per la mappare nodi remoti ai receivers e gestire i nodi remoti
  - name: DDOs
    description: Daas Data Object, messaggi inviati tra i nodi daas
  - name: devices
  - name: device models
  - name: device model groups
    description: gruppi di modelli di device, che raggruppano i modelli di device
  - name: typesets
    description: gestione dei typesets, che identificano la struttura dei messaggi inviati tra i nodi daas
  - name: programming
    description: API per la programmazione remota dei dispositivi concatenando regole di programmazione
  - name: device model functions
  - name: device functions

#region Components

components:
  parameters:
    limit:
      name: limit
      in: query
      description: Numero massimo di oggetti da ritornare
      required: false
      schema:
        type: integer
        minimum: 1
        default: 20
      example: 20
    offset:
      name: offset
      in: query
      description: Offset per la paginazione
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      example: 0

  responses:
    InternalError:
      description: Errore interno del server
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    PlaceHolder:
      description: Placeholder
      content:
        application/json:
          schema:
            type: string
            example: "Work in progess API endpoint"

  schemas:
    DinLocal:
      type: object
      properties:
        id:
          type: integer
          description: ID del receiver
        title:
          type: string
          description: Nome del receiver
        acpt_all:
          type: boolean
          description: Flag per accettare messaggi da nodi non mappati
          default: false
        enable:
          type: boolean
          default: false
        din_id:
          type: integer
          description: ID del DIN associato al receiver

    DinLocalFull:
      allOf:
        - $ref: "#/components/schemas/DinLocal"
        - type: object
          properties:
            din:
              $ref: "#/components/schemas/Din"
            links:
              type: array
              items:
                $ref: "#/components/schemas/DinLink"
            device:
              $ref: "#/components/schemas/Device"
              nullable: true

    DinLink:
      type: object
      properties:
        id:
          type: integer
          description: ID del link
        url:
          type: string
          description: dati del link, es. IP in caso di link di tipo 2
          example: "127.0.0.1:2001"
        link:
          type: integer
          description: tipo di link
          enum: [1, 2, 3, 4]
          example: 2
        din_id:
          type: integer
          description: ID del DIN al quale è associato il link
    Din:
      type: object
      properties:
        id:
          type: integer
          description: ID del DIN
        sid:
          type: string
          description: identificatore della rete daas (SID)
        din:
          type: string
          description: identificatore univoco del nodo daas all'interno della rete
        p_res:
          type: string
          description: preferenze di rete dell'utente, (riservatezza,
          example: "000"
        skey:
          type: string
          description: SKEY del DIN
          example: "9efbaeb2a94f"

    DinWithLinks:
      allOf:
        - $ref: "#/components/schemas/Din"
        - type: object
          properties:
            links:
              type: array
              items:
                $ref: "#/components/schemas/DinLink"

    DinWithLinksAndReceiver:
      allOf:
        - $ref: "#/components/schemas/DinWithLinks"
        - type: object
          properties:
            receiver:
              $ref: "#/components/schemas/DinLocal"
              nullable: true

    DinMappingFull:
      type: object
      properties:
        pdin_id:
          type: integer
          description: ID del DIN del nodo padre, in quale mappa il DIN con id 'cdin_id'
        cdin_id:
          type: integer
          description: ID del DIN del nodo figlio, mappato dal nodo padre con id 'pdin_id'
        cdin:
          $ref: "#/components/schemas/DinWithLinksAndReceiver"

    DeviceCreationObject:
      type: object
      properties:
        device_model_id:
          type: integer
          description: ID del modello del device
        din_id:
          type: integer
          description: ID del DIN associato al device
        name:
          type: string
          description: Nome del device
        serial:
          type: string
          description: Seriale del device
        latitude:
          type: number
          description: latitudine
          example: 39.3015
        longitude:
          type: number
          description: longitudine
          example: 16.2536
      required:
        - din_id
        - name
        - serial

    Device:
      allOf:
        - $ref: "#/components/schemas/DeviceCreationObject"
        - type: object
          properties:
            id:
              type: integer
              description: ID del Device

    DeviceFull:
      allOf:
        - $ref: "#/components/schemas/Device"
        - type: object
          properties:
            device_model:
              $ref: "#/components/schemas/DeviceModel"
            din:
              $ref: "#/components/schemas/Din"

    DeviceModelCreationObject:
      type: object
      properties:
        device_group_id:
          type: integer
          description: ID del gruppo del modello
        description:
          type: string
          description: descrizione del modello
        name:
          type: string
          description: nome del modello

    DeviceModel:
      allOf:
        - $ref: "#/components/schemas/DeviceModelCreationObject"
        - type: object
          properties:
            id:
              type: integer
              description: ID del modello del device
              nullable: false

    DeviceModelWithResources:
      allOf:
        - $ref: "#/components/schemas/DeviceModel"
        - type: object
          properties:
            resources:
              type: array
              items:
                $ref: "#/components/schemas/DeviceModelResource"

    DeviceModelFull:
      allOf:
        - $ref: "#/components/schemas/DeviceModel"
        - type: object
          properties:
            device_group:
              $ref: "#/components/schemas/DeviceModelGroup"
            resources:
              type: array
              items:
                $ref: "#/components/schemas/DeviceModelResource"

    DeviceModelGroup:
      type: object
      properties:
        id:
          type: integer
          description: ID del gruppo del modello
          nullable: false
        title:
          type: string
          description: titolo del gruppo
          maxLength: 45
        description:
          type: string
          description: descrizione del gruppo
        link_image:
          type: string
          format: uri
          description: collegamento all'immagine del gruppo
          example: "https://placehold.co/600x400"

    DeviceModelResource:
      type: object
      properties:
        id:
          type: integer
          description: ID della risorsa
          nullable: false
        name:
          type: string
          nullable: false
        device_model_id:
          type: integer
          description: ID del modello di device al quale si riferisce questa risorsa
          nullable: false
        link:
          type: string
          format: uri
          description: collegamento alla risorsa
          maxLength: 255
          example: "https://placehold.co/600x400"
        resource_type:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
            - 5
          description: >
            Tipo di risorsa

            1: altro

            2: scheda tecnica

            3: scheda utente

            4: immagine

            5: binario
          nullable: false

    DeviceModelFunctionProperty:
      description: >
        Property (param, input, output, notification) di una DeviceModelFunction
        Interpretabile come definizione per le properties di una DeviceFunction.

        Non contiene valori di istanza come 'value' che fanno invece parte di DeviceFunctionProperty
      type: object
      properties:
        id:
          type: integer
          description: ID della property
          nullable: false
        property_type:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
          description: >
            Tipo di property
            1: parameter
            2: input
            3: output
            4: notification
          nullable: false
        name:
          type: string
          description: nome della property
          maxLength: 45
        function_id:
          type: integer
          description: ID della DeviceModelFunction a cui si riferisce questa property
          nullable: false
        data_type:
          type: integer
          description: >
            tipo di dato
            1: i32
            2: i16
            3: f32
            4: string
            5: i8
            6: i64
            7: f64
          nullable: false
        default_value:
          type: string
          description: valore di default della property
          maxLength: 45
        safe_value:
          type: string
          description: valore sicuro della property, usato in caso di errore
          maxLength: 45

    DeviceModelFunctionBase:
      type: object
      description: >
        Funzione di un modello di device
        Interpretabile come definizione per le funzioni di un device che sono istanze di questa funzione
      properties:
        name:
          type: string
          description: nome della funzione
          maxLength: 45
        device_model_id:
          type: integer
          description: ID del modello di device a cui si riferisce questa funzione
          nullable: false
        parameters:
          type: array
          items:
            $ref: "#/components/schemas/DeviceModelFunctionProperty"
          description: lista dei parametri della funzione
        inputs:
          type: array
          items:
            $ref: "#/components/schemas/DeviceModelFunctionProperty"
          description: lista degli input della funzione
        outputs:
          type: array
          items:
            $ref: "#/components/schemas/DeviceModelFunctionProperty"
          description: lista degli output della funzione
        notifications:
          type: array
          items:
            $ref: "#/components/schemas/DeviceModelFunctionProperty"
          description: lista delle notifiche della funzione

    DeviceModelFunctionCreationObject:
      allOf:
        - $ref: "#/components/schemas/DeviceModelFunctionBase"
        - type: object
          properties:
            properties:
              type: array
              items:
                $ref: "#/components/schemas/DeviceModelFunctionProperty"
              description: lista delle properties della funzione

    DeviceModelFunction:
      allOf:
        - $ref: "#/components/schemas/DeviceModelFunctionBase"
        - type: object
          properties:
            id:
              type: integer
              description: ID della funzione
              nullable: false

    DeviceFunctionProperty:
      type: object
      description: >
        Property (param, input, output, notification) di una DeviceFunction
        Interpretabile come istanza di un property di una DeviceModelFunction
      properties:
        id:
          type: integer
          description: ID della property
          nullable: false
        property_id:
          type: integer
          description: ID della property del modello di device
          nullable: false
        device_function_id:
          type: integer
          description: ID della DeviceFunction a cui si riferisce questa property
          nullable: false
        property_type:
          type: integer
          enum:
            - 1
            - 2
            - 3
            - 4
          description: >
            Tipo di property
            1: parameter
            2: input
            3: output
            4: notification
          nullable: false
        value:
          type: string
          description: valore della property in formato stringa
          maxLength: 45
        property_template:
          $ref: "#/components/schemas/DeviceModelFunctionProperty"
          nullable: true

    DeviceFunction:
      type: object
      description: >
        Funzione di un device
        Interpretabile come istanza di una DeviceModelFunction
      properties:
        id:
          type: integer
          description: ID della funzione
          nullable: false
        device_id:
          type: integer
          description: ID del device a cui è associata questa funzione
          nullable: false
        device_model_function_id:
          type: integer
          description: ID della DeviceModelFunction a cui si riferisce questa funzione
          nullable: false
        enabled:
          type: boolean
          description: flag per abilitare/disabilitare la funzione
          nullable: false
        function:
          $ref: "#/components/schemas/DeviceModelFunction"
          description: definizione della funzione
        parameters:
          type: array
          items:
            $ref: "#/components/schemas/DeviceFunctionProperty"
          description: lista dei parametri della funzione
        inputs:
          type: array
          items:
            $ref: "#/components/schemas/DeviceFunctionProperty"
          description: lista degli input della funzione
        outputs:
          type: array
          items:
            $ref: "#/components/schemas/DeviceFunctionProperty"
          description: lista degli output della funzione
        notifications:
          type: array
          items:
            $ref: "#/components/schemas/DeviceFunctionProperty"
          description: lista delle notifiche della funzione

    DDO:
      description: Daas Data Object
      type: object
      properties:
        id:
          type: integer
          description: ID del DDO
          nullable: false
          example: 3
        din_id_dst:
          type: integer
          description: ID del DIN che ha ricevuto questo DDO
          nullable: false
          example: 2
        din_id_src:
          type: integer
          description: ID del DIN che ha inviato questo DDO
          nullable: false
          example: 1
        timestamp:
          type: string
          format: date-time
          description: Data e orario di quando è stato inviato il DDO
          nullable: true
          example: 2024-07-21T17:32:28Z
        typeset_id:
          type: integer
          nullable: false
          example: 41
        payload:
          type: string
          format: base
          description: Payload contenuto all'interno del DDO, in codifica Base64
          nullable: true
          example: eyJtZXNzYWdnaW8iOiAiY2lhbyBNb25kbyJ9
        payload_size:
          type: integer
          description: Dimensione del payload decodificato in byte, per come è stato ricevuto
          nullable: true
          example: 32

    PaginationData:
      description: Meta dati sulla paginazione dei dati
      properties:
        count:
          type: integer
          description: numero di oggetti contenuti tra i dati della risposta
          minimum: 0
          example: 20
        offset:
          type: integer
          description: gli oggetti contenuti dei dati della risposta partono da questo offset
          minimum: 40
        limit:
          type: integer
          description: numero massimo di oggetti contenuti tra i dati della risposta
          minimum: 0
          example: 20
        total:
          description: numero totale di oggetti per questa query
          type: integer
          minimum: 0
          example: 67
        has_next:
          type: boolean
          description: flag che indica se ci sono altri oggetti da visualizzare
          example: true
        has_prev:
          type: boolean
          description: flag che indica se ci sono oggetti precedenti da visualizzare
          example: false

    Error:
      type: object
      properties:
        error_name:
          type: string
          description: Nome dell'errore
          example: "TypeError"
        message:
          type: string
          description: Messaggio di errore

#region Paths
paths:
  /:
    get:
      responses:
        "200":
          description: OK

  /configure:
    post:
      description: Carica la configurazione del nodo locale (per il din_local con id=1)
      tags:
        - configuration
      responses:
        "200":
          description: configurazione applicata.
        default:
          $ref: "#/components/responses/InternalError"

  /stop:
    post:
      description: Ferma il nodo daas locale
      tags:
        - lifecycle
      responses:
        "200":
          description: Nodo fermato.
        default:
          description: Impossibile fermare il nodo locale.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /start:
    post:
      description: Avvia il nodo daas locale
      tags:
        - lifecycle
      responses:
        "200":
          description: Nodo locale avviato.
        default:
          description: Impossibile avviare il nodo locale.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /restart:
    post:
      description: Riavvia il nodo daas locale
      tags:
        - lifecycle
      responses:
        default:
          description: Non ancora implementato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /send:
    post:
      description: Invia un messaggio tramite il nodo daas locale al DIN specificato
      tags:
        - commands
      requestBody:
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                din:
                  type: integer
                  description: Il DIN a cui inviare il messaggio
                typeset:
                  type: integer
                  description: Il typeset del messaggio
                payload:
                  type: object
                  description: Il payload del messaggio
                  nullable: true
              required:
                - din
                - typeset
              example:
                din: 105
                typeset: 701
                payload: { "temperature": 25.5, "humidity": 50 }
      responses:
        "200":
          description: Messaggio inviato.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio inviato.
        default:
          $ref: "#/components/responses/InternalError"

  /status:
    get:
      description: Ritorna lo status del nodo locale.
      tags:
        - lifecycle
      responses:
        "200":
          description: Infomazioni sullo stato del nodo.s
          content:
            application/json:
              schema:
                type: object
                properties:
                  lasttime:
                    type: number
                    description: time reference
                  hwver:
                    type: number
                    description: platform (hard-coded) when the node was contructed
                  linked:
                    type: number
                    description: channels counter (0=not linked)
                  sync:
                    type: number
                    description: synchronization status (0=not in sync)
                  lock:
                    type: number
                    description: required security policy
                  sklen:
                    type: number
                    description: security phrase length
                  skey:
                    type: string
                    description: security phrase (UTF-8)
                  form:
                    type: number
                    description: data formatting model
                  codec:
                    type: number
                    description: data encryption level
        default:
          $ref: "#/components/responses/InternalError"

  /version:
    get:
      description: Restituisce le versioni di librerie e software utilizzate dal nodo.
      tags:
        - configuration
      responses:
        "200":
          description: Versioni delle librerie e del software utilizzate dal nodo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  daasLibrary:
                    type: string
                    description: versione della libreria interna Daas
                    example: "0.17a"
                  nodeGyp:
                    type: string
                    description: versione di node-gyp utilizzata per costruire il binario (daas-sdk)
                    example: "8.0.0"
                  compiler:
                    type: string
                    description: nome del compilatore c++ utilizzato e la sua versione (GCC, Clang/LLVM, MSVC)
                    example: "GCC 10.2.1 20210110"
                  cppStandardLibrary:
                    type: string
                    description: versione della libreria standard c++ utilizzata (GNU libstdc++, LLVM libc++, MSVC STL)
                    example: "GNU libstdc++ 20210110"
                  node:
                    type: string
                    description: versione di Node.js
                    example: "20.17.0"
                  nodeAddonApi:
                    type: string
                    description: versione dell'addon API di Node.js
                    example: "9"

  /dev/db_sync:
    post:
      description: >
        Valido solo in ambiente di sviluppo.


        Sincronizza il database locale con il modello di dati sequelize
      tags:
        - configuration
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                force:
                  type: boolean
                  description: Forza la sincronizzazione
              example:
                force: true
      responses:
        "200":
          description: Database sincronizzato.
        "403":
          description: Non autorizzato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"
  #region Receivers

  /receivers:
    get:
      description: Ritorna una lista di tutti i receivers.
      tags:
        - receivers
      responses:
        "200":
          description: Lista di tutti i receivers.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DinLocalFull"

        default:
          $ref: "#/components/responses/InternalError"

    post:
      description: Crea un nuovo receiver
      tags:
        - receivers
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                din:
                  $ref: "#/components/schemas/Din"
                title:
                  type: string
                  description: Nome del receiver
              required:
                - din
                - title
              example:
                din: { "sid": "100", "din": "87" }
                title: "Receiver 1"
      responses:
        "200":
          description: Receiver aggiunto con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DinLocalFull"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /receivers/count:
    get:
      description: Ritorna il numero di receivers presenti.
      tags:
        - receivers
      responses:
        "200":
          description: Numero di receivers presenti.
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: Numero di receivers presenti
        default:
          $ref: "#/components/responses/InternalError"

  /receivers/{receiverId}:
    get:
      description: Ritorna un receiver specifico.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Receiver trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DinLocalFull"
                description: Receiver completo con i dati del DIN associato e i link
        "404":
          description: Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    put:
      description: Aggiorna un receiver specifico.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                din:
                  $ref: "#/components/schemas/Din"
                title:
                  type: string
                  description: Nome del receiver
                enable:
                  type: boolean
                  description: Flag per abilitare/disabilitare il receiver
                acpt_all:
                  type: boolean
                  description: Flag per accettare messaggi da nodi non mappati
              required:
                # TODO: rendere il din non obbligatorio
                - din
                - title
              example:
                din: { "sid": "100", "din": "87" }
                title: "Receiver 1"
      responses:
        "200":
          description: Receiver aggiornato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Receiver o Din non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    delete:
      description: Elimina un receiver specifico.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Receiver eliminato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  #region Receivers links

  /receivers/{receiverId}/links:
    get:
      description: Ritorna i link associati al receiver.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Lista di tutti i link associati al receiver.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DinLink"
        "404":
          description: Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    post:
      description: Aggiunge un link al receiver.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  description: URL del link
                link:
                  type: integer
                  description: Tipo di link
                  enum: [1, 2, 3, 4]
              required:
                - url
                - link
              example:
                link: 2
                url: "151.81.1.4:2001"
      responses:
        "200":
          description: Link aggiunto con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DinLink"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /receivers/{receiverId}/links/{id}:
    get:
      description: Ritorna un link specifico associato al receiver.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
        - name: id
          in: path
          description: ID del link
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Link trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DinLink"
        "404":
          description: Link non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    put:
      description: Aggiorna un link specifico associato al receiver.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
        - name: id
          in: path
          description: ID del link
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  description: URL del link
                link:
                  type: integer
                  description: Tipo di link
                  enum: [1, 2, 3, 4]
              example:
                url: "1.2.3.4:6045"
      responses:
        "200":
          description: Link aggiornato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Link non appartiene al receiver.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Link o Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    delete:
      description: Elimina un link specifico associato al receiver.
      tags:
        - receivers
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
        - name: id
          in: path
          description: ID del link
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Link eliminato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Link o Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Link non appartiene al receiver.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  #region DINs

  /dins:
    get:
      description: Ritorna una lista di tutti i DINs.
      tags:
        - receivers
        - remotes
      responses:
        "200":
          description: Lista di tutti i DINs.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Din"
        default:
          $ref: "#/components/responses/InternalError"

  /remotes:
    get:
      description: Ritorna una lista di tutti i nodi remoti, ovvero i DINs non associati ad un receiver.
      tags:
        - remotes
      responses:
        "200":
          description: Lista di tutti i nodi remoti.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DinWithLinks"

        default:
          $ref: "#/components/responses/InternalError"

  /remotes/count:
    get:
      description: Ritorna il numero di nodi remoti presenti.
      tags:
        - remotes
      responses:
        "200":
          description: Numero di nodi remoti presenti.
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: Numero di nodi remoti presenti
        default:
          $ref: "#/components/responses/InternalError"

  #region Receivers remotes

  /receivers/{receiverId}/remotes:
    get:
      description: Ritorna tutti i nodi mappati sul receiver.
      tags:
        - receivers
        - remotes
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Lista di tutti i nodi mappati sul receiver.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DinMappingFull"
        "404":
          description: Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    post:
      description: Associa e modifica un nodo remoto al receiver, se non esiste lo crea.
      tags:
        - receivers
        - remotes
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                din:
                  $ref: "#/components/schemas/Din"
                link:
                  $ref: "#/components/schemas/DinLink"
              required:
                - din
            examples:
              new remote:
                value:
                  din:
                    {
                      "sid": "100",
                      "din": "87",
                      "p_res": "011",
                      "skey": "9efb9832494f",
                    }
              existing remote:
                value:
                  din: { "id": 2 }
              existing remote, make changes:
                value:
                  din: { "id": 2, "din": "1669" }
                  link: { "id": 1, "url": "123.45.67.89:1234" }
              existing remote, add link:
                value:
                  din: { "id": 2 }
                  link: { "link": 2, "url": "99.99.99.99:9999" }
              existing remote, change link:
                value:
                  din: { "id": 2 }
                  link: { "id": 2, "url": "98.98.98.98:9898" }

      responses:
        "200":
          description: Nodo remoto associato con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DinMappingFull"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Receiver o remote non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    delete:
      description: Elimina tutte le associazione del receiver con i nodi remoti.
      tags:
        - receivers
        - remotes
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Associazioni eliminate con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "501":
          description: Non ancora implementato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /receivers/{receiverId}/remotes/{id}:
    get:
      description: Ritorna un nodo remoto specifico associato al receiver.
      tags:
        - receivers
        - remotes
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
        - name: id
          in: path
          description: ID del nodo remoto
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Nodo remoto trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DinMappingFull"
        "404":
          description: Receiver o nodo remoto mappato a receiver non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    delete:
      description: Elimina l'associazione tra il nodo remoto e il receiver, se il nodo remoto non ha altre associazioni, viene cancellato.
      tags:
        - receivers
        - remotes
      parameters:
        - name: receiverId
          in: path
          description: ID del receiver
          required: true
          schema:
            type: integer
        - name: id
          in: path
          description: ID del nodo remoto
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Nodo remoto eliminato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Receiver o nodo remoto non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  #region Devices

  /devices:
    get:
      description: mostra una pagina di tutti i devices o una lista filtrata.
      parameters:
        - $ref: "#/components/parameters/limit"
        - $ref: "#/components/parameters/offset"
        - name: q
          in: query
          description: >
            Filtro per nome del device.
          schema:
            type: string
          example: "Device 1"

      tags:
        - devices
      responses:
        "200":
          description: Lista di tutti i devices.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Device"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
        default:
          $ref: "#/components/responses/InternalError"
    post:
      description: Crea un nuovo device, con associato un device model e un DIN.
      tags:
        - devices
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeviceCreationObject"
              example:
                device_model_id: 4
                din_id: 1
                name: "Device 1"
                latitude: 39.3015
                longitude: 16.2536
      responses:
        "200":
          description: Device aggiunto con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Device"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Device model o DIN non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /devices/{deviceId}:
    get:
      description: Ritorna un device specifico.
      tags:
        - devices
      parameters:
        - name: deviceId
          in: path
          description: ID del device
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Device trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceFull"
        "404":
          description: Device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    put:
      description: Aggiorna un device specifico e il DIN associato.
      tags:
        - devices
      parameters:
        - name: deviceId
          in: path
          description: ID del device
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/DeviceCreationObject"
                - type: object
                  properties:
                    din:
                      $ref: "#/components/schemas/Din"
              example:
                name: "device 2024"
                din: { "sid": "100", "din": "87" }
      responses:
        "200":
          description: Device aggiornato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Device model o DIN non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    delete:
      description: Elimina un device specifico.
      tags:
        - devices
      parameters:
        - name: deviceId
          in: path
          description: ID del device
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Device eliminato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /devices/{deviceId}/ddos/:
    parameters:
      - name: deviceId
        in: path
        description: ID del device che ha ricevuto o inviato i DDO
        required: true
        schema:
          type: integer
          minimum: 0
          example: 1
    get:
      description: Ritorna i ddo ricevuti o inviati da un device. Di default ritorna i DDO ricevuti.
      tags:
        - devices
        - DDOs
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
        - name: sent
          in: query
          description: Se true ritorna i DDO inviati, altrimenti i DDO ricevuti
          schema:
            type: boolean
          example: true
      responses:
        "200":
          description: Pagina di DDO e informazioni sulla paginazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DDO"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
        "404":
          description: Device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /devices/{deviceId}/reports/:
    parameters:
      - name: deviceId
        in: path
        description: ID del device che ha ricevuto o inviato i DDO
        required: true
        schema:
          type: integer
          minimum: 0
          example: 1
    get:
      description: Ritorna i ddo ricevuti o inviati da un device sotto formato di pdf o excel.
      tags:
        - devices
        - DDOs
      parameters:
        - name: extension
          required: false
          in: query
          description: definisce l'estensione del file, se pdf o xlsx
          schema:
            type: string
            enum: [pdf, xlsx]
            example: pdf
      responses:
        "200":
          description: Pagina di DDO e informazioni sulla paginazione
          content:
            application/pdf:
              schema:
                type: string
                format: binary
              # examples:
              #   sampleFile:
              #     summary: Un esempio di file PDF
              #     externalValue: "../../static/public/img/reporting_templates/esempio_report.pdf"
        "404":
          description: Device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "415":
          description: Estensione non valida o non supportata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: problema nella generazione del report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  #region Device Models

  /device_models:
    get:
      description: Ritorna una pagina di tutti i modelli di device.
      tags:
        - device models
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
        - name: q
          in: query
          description: >
            Filtro per nome del modello di device.
          schema:
            type: string
          example: "modello 2"

      responses:
        "200":
          description: Pagina di modelli di device e informazioni sulla paginazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DeviceModelFull"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
                  q:
                    type: string
                    description: Filtro applicato
                    nullable: true

        default:
          $ref: "#/components/responses/InternalError"

    post:
      description: >
        Crea un nuovo modello di device, associando un gruppo di device esistente o creandone uno nuovo se non esiste.

        Permette di creare risorse di device da allegare al modello e DeviceModelFunctions per definire le funzioni che questo modello può eseguire.
      tags:
        - device models
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/DeviceModelCreationObject"
                - type: object
                  properties:
                    device_group:
                      $ref: "#/components/schemas/DeviceModelGroup"
                    resources:
                      type: array
                      items:
                        $ref: "#/components/schemas/DeviceModelResource"
                    functions:
                      type: array
                      items:
                        $ref: "#/components/schemas/DeviceModelFunction"

              required:
                - description
                - serial
            example:
              name: ESP32
              description: ESP32 DIY Modules
              device_group:
                title: ESP32 DIY Modules
                description: ESP32 DIY Modules
                link_image: https://ce8dc832c.cloudimg.io/v7/_cdn_/BE/B6/90/00/0/617451_1.jpg?width=640&height=480&wat=1&wat_url=_tme-wrk_%2Ftme_new.png&wat_scale=100p&ci_sign=ecbc082e1968d44612ae5635e6defb9c957a3da9
              resources:
                - name: cover
                  link: https://m.media-amazon.com/images/I/71D4E5DS-qL.jpg
                  resource_type: 4
                - name: datasheet
                  link: https://www.espressif.com/sites/default/files/documentation/esp32_datasheet_en.pdf
                  resource_type: 2
                - name: hardware design guidelines
                  link: https://www.espressif.com/sites/default/files/documentation/esp32_hardware_design_guidelines_en.pdf
                  resource_type: 2
                - name: programming guide
                  link: https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html
                  resource_type: 1
                - name: firmware
                  link: http://example.com/firmware.dsfw
                  resource_type: 5
              functions:
                - name: PID1
                  parameters:
                    - name: P
                      data_type: 1
                    - name: I
                      data_type: 1
                    - name: D
                      data_type: 1
                    - name: Frequenza
                      data_type: 1
                    - name: Timeout
                      data_type: 1
                  inputs:
                    - name: target
                      data_type: 1
                    - name: corrente
                      data_type: 1
                  outputs:
                    - name: pilota
                      data_type: 1
                - name: PLN1
                  parameters:
                    - name: ix
                      data_type: 1
                    - name: week-day
                      data_type: 1
                    - name: time
                      data_type: 1
                    - name: pilota
                      data_type: 1
                  outputs:
                    - name: pilota
                      data_type: 1

      responses:
        "200":
          description: Modello di device aggiunto con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModel"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /device_models/{deviceModelId}:
    parameters:
      - name: deviceModelId
        in: path
        description: ID del modello di device
        required: true
        schema:
          type: integer

    get:
      description: Ritorna un modello di device specifico.
      tags:
        - device models
      responses:
        "200":
          description: Modello di device trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModelFull"
        "404":
          description: Modello di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    put:
      description: Aggiorna un modello di device specifico.
      tags:
        - device models
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeviceModelCreationObject"
              example:
                device_group_id: 1
                name: "Modello 1"
                description: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas egestas sed felis eu blandit. Nullam maximus id arcu malesuada ultricies. In varius odio ac tempus condimentum. "
      responses:
        "200":
          description: Modello di device aggiornato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Modello di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"
    delete:
      description: Elimina un modello di device specifico.
      tags:
        - device models
      responses:
        "200":
          description: Modello di device eliminato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Modello di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /device_models/{deviceModelId}/devices:
    parameters:
      - name: deviceModelId
        in: path
        description: ID del modello di device
        required: true
        schema:
          type: integer
    get:
      description: Ritorna i devices associati al modello di device specificato
      tags:
        - device models
        - devices
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
        - name: q
          in: query
          description: >
            Filtro per nome del device.
          schema:
            type: string
          example: "Device 1"
      responses:
        "200":
          description: Pagina di devices e informazioni sulla paginazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Device"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
                  q:
                    type: string
                    description: Filtro applicato
                    nullable: true
        "404":
          description: Modello di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /device_models/{deviceModelId}/resources:
    parameters:
      - name: deviceModelId
        in: path
        description: ID del modello di device
        required: true
        schema:
          type: integer
    get:
      description: Ritorna le risorse associate al modello di device specificato
      tags:
        - device models
      parameters:
        - name: type
          in: query
          description: >
            Filtro per tipo di risorsa.
          schema:
            type: integer
            enum:
              - 1
              - 2
              - 3
              - 4
              - 5
          example: 4
      responses:
        "200":
          description: Lista di risorse associate al modello di device.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceModelResource"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    post:
      description: >
        Aggiunge una risorsa al modello di device.
      tags:
        - device models
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Nome della risorsa
                  maxLength: 45
                link:
                  type: string
                  format: uri
                  description: collegamento alla risorsa
                  maxLength: 255
                  example: "https://placehold.co/600x400"
                resource_type:
                  type: integer
                  enum:
                    - 1
                    - 2
                    - 3
                    - 4
                    - 5
                  description: >
                    Tipo di risorsa

                    1: altro

                    2: scheda tecnica

                    3: scheda utente

                    4: immagine

                    5: binario
                  nullable: false
                  example: 1
              required:
                - name
                - link
                - resource_type
              example:
                name: "copertina"
                link: "https://placehold.co/200x300"
                resource_type: 4
      responses:
        "200":
          description: Risorsa aggiunta con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModelResource"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Modello di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /device_models/{deviceModelId}/resources/{resourceId}:
    parameters:
      - name: deviceModelId
        in: path
        description: ID del modello di device
        required: true
        schema:
          type: integer
      - name: resourceId
        in: path
        description: ID della risorsa
        required: true
        schema:
          type: integer
    delete:
      description: Elimina una risorsa specifica associata al modello di device.
      tags:
        - device models
      responses:
        "200":
          description: Risorsa eliminata con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Modello di device o risorsa non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  #region Device Model Groups

  /device_model_groups:
    get:
      description: Ritorna una pagina di tutti i gruppi di modelli di device.
      tags:
        - device model groups
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
        - name: q
          in: query
          description: >
            Filtro per nome del gruppo di modelli di device.
          schema:
            type: string
          example: "Gruppo 1"
      responses:
        "200":
          description: Pagina di gruppi di modelli di device e informazioni sulla paginazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DeviceModelGroup"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
                  q:
                    type: string
                    description: Filtro applicato
                    nullable: true
        default:
          $ref: "#/components/responses/InternalError"

    post:
      description: Crea un nuovo gruppo di modelli di device.
      tags:
        - device model groups
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Nome del gruppo
                  maxLength: 45
                description:
                  type: string
                  description: Descrizione del gruppo
                  maxLength: 45
                link_image:
                  type: string
                  format: uri
                  description: Collegamento all'immagine del gruppo
              required:
                - name
              example:
                name: "Gruppo 1"
      responses:
        "200":
          description: Gruppo di modelli di device aggiunto con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModelGroup"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /device_model_groups/{deviceModelGroupId}:
    parameters:
      - name: deviceModelGroupId
        in: path
        description: ID del gruppo di modelli di device
        required: true
        schema:
          type: integer
    get:
      description: Ritorna un gruppo di modelli di device specifico.
      tags:
        - device model groups
      responses:
        "200":
          description: Gruppo di modelli di device trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModelGroup"
        "404":
          description: Gruppo di modelli di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    put:
      description: Aggiorna un gruppo di modelli di device specifico.
      tags:
        - device model groups
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Nome del gruppo
                  maxLength: 45
                description:
                  type: string
                  description: Descrizione del gruppo
                  maxLength: 45
                link_image:
                  type: string
                  format: uri
                  description: Collegamento all'immagine del gruppo
              example:
                name: "Gruppo 1"
      responses:
        "200":
          description: Gruppo di modelli di device aggiornato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Gruppo di modelli di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    delete:
      description: Elimina un gruppo di modelli di device specifico.
      tags:
        - device model groups
      responses:
        "200":
          description: Gruppo di modelli di device eliminato con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Gruppo di modelli di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /device_model_groups/{deviceModelGroupId}/device_models:
    get:
      description: Ritorna i modelli di device associati al gruppo di modelli di device specificato
      tags:
        - device model groups
        - device models
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
        - name: q
          in: query
          description: >
            Filtro per nome del modello di device.
          schema:
            type: string
          example: "Modello 2"
      responses:
        "200":
          description: Pagina di modelli di device e informazioni sulla paginazione
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DeviceModelWithResources"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
                  q:
                    type: string
                    description: Filtro applicato
                    nullable: true
        "404":
          description: Gruppo di modelli di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  #endregion Device Model Groups

  #region Programming

  /device_models/any/functions:
    get:
      parameters:
        - $ref: "#/components/parameters/offset"
        - $ref: "#/components/parameters/limit"
      description: Ritorna un elenco di tutte le funzioni disponibili per qualsiasi modello di device.
      tags:
        - device models
        - programming
        - device model functions
      responses:
        "200":
          description: Pagina di funzioni di tutte le funzioni disponibili per qualsiasi modello di device.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DeviceModelFunction"
                  pagination:
                    $ref: "#/components/schemas/PaginationData"
        default:
          $ref: "#/components/responses/InternalError"

  /device_models/{deviceModelId}/functions:
    parameters:
      - name: deviceModelId
        in: path
        description: ID del modello di device
        required: true
        schema:
          type: integer

    get:
      description: Ritorna un elenco di tutte le funzioni disponibili per un certo modello di device.
      tags:
        - device models
        - programming
        - device model functions
      responses:
        "200":
          description: Lista di funzioni del modello di device.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceModelFunction"
        "404":
          description: Modello di device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

    # post:
    #   description: >
    #     Aggiunge una nuova funzione al modello di device.
    #   tags:
    #     - device models
    #     - programming
    #     - device model functions
    #   requestBody:
    #     content:
    #       application/json:
    #         schema:
    #           type: object
    #           properties:
    #             name:
    #               type: string
    #               description: Nome della funzione
    #               maxLength: 45
    #             parameters:
    #               type: array
    #               items:
    #                 type: object
    #                 description: Parametri della funzione
    #                 properties:
    #                   name:
    #                     type: string
    #                     description: Nome del parametro
    #                     maxLength: 45
    #                   data_type:
    #                     type: integer
    #                     enum:
    #                       - 1
    #                       - 2
    #                       - 3
    #                     description: >
    #                       Tipo di dato del parametro
    #                       1: i32
    #                       2: i16
    #                       3: f32
    #                       4: string
    #                   default_value:
    #                     type: string
    #                     description: Valore di default del parametro
    #                     maxLength: 45
    #                   safe_value:
    #                     type: string
    #                     description: Valore sicuro del parametro
    #                     maxLength: 45
    #             inputs:
    #               type: array
    #               items:
    #                 type: object
    #                 description: Input della funzione
    #                 properties:
    #                   name:
    #                     type: string
    #                     description: Nome dell'input
    #                     maxLength: 45
    #                   data_type:
    #                     type: integer
    #                     enum:
    #                       - 1
    #                       - 2
    #                       - 3
    #                     description: >
    #                       Tipo di dato dell'input
    #                       1: i32
    #                       2: i16
    #                       3: f32
    #                       4: string
    #                   default_value:
    #                     type: string
    #                     description: Valore di default dell'input
    #                     maxLength: 45
    #                   safe_value:
    #                     type: string
    #                     description: Valore sicuro dell'input
    #                     maxLength: 45
    #             outputs:
    #               type: array
    #               items:
    #                 type: object
    #                 description: Output della funzione
    #                 properties:
    #                   name:
    #                     type: string
    #                     description: Nome dell'output
    #                     maxLength: 45
    #                   data_type:
    #                     type: integer
    #                     enum:
    #                       - 1
    #                       - 2
    #                       - 3
    #                     description: >
    #                       Tipo di dato dell'output
    #                       1: i32
    #                       2: i16
    #                       3: f32
    #                       4: string
    #                   default_value:
    #                     type: string
    #                     description: Valore di default dell'output
    #                     maxLength: 45
    #                   safe_value:
    #                     type: string
    #                     description: Valore sicuro dell'output
    #                     maxLength: 45
    #             notifications:
    #               type: array
    #               items:
    #                 type: object
    #                 description: Notifiche della funzione
    #                 properties:
    #                   name:
    #                     type: string
    #                     description: Nome della notifica
    #                     maxLength: 45
    #                   data_type:
    #                     type: integer
    #                     enum:
    #                       - 1
    #                       - 2
    #                       - 3
    #                     description: >
    #                       Tipo di dato della notifica
    #                       1: i32
    #                       2: i16
    #                       3: f32
    #                       4: string
    #                   default_value:
    #                     type: string
    #                     description: Valore di default della notifica
    #                     maxLength: 45
    #                   safe_value:
    #                     type: string
    #                     description: Valore sicuro della notifica
    #                     maxLength: 45
    #           required:
    #             - name
    #   responses:
    #     '200':
    #       description: Funzione del modello di device aggiunta con successo.
    #       content:
    #         application/json:
    #           schema:
    #             $ref: '#/components/schemas/DeviceModelFunction'
    #     '400':
    #       description: Errore nei parametri della richiesta.
    #       content:
    #         application/json:
    #           schema:
    #             $ref: '#/components/schemas/Error'
    #     '404':
    #       description: Modello di device non trovato.
    #       content:
    #         application/json:
    #           schema:
    #             $ref: '#/components/schemas/Error'
    #     default:
    #       $ref: '#/components/responses/InternalError'

    # template di tutte le funzionzi disponibili per un certo modello di device
  /device_models/{deviceModelId}/functions/{deviceModelFunctionId}:
    parameters:
      - name: deviceModelId
        in: path
        description: ID del modello di device
        required: true
        schema:
          type: integer
      - name: deviceModelFunctionId
        in: path
        description: ID della funzione del modello di device
        required: true
        schema:
          type: integer
    get:
      description: Ritorna una funzione del modello di device specifica.

      tags:
        - device models
        - programming
        - device model functions
      responses:
        "200":
          description: Funzione del modello di device trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceModelFunction"
        "404":
          description: Funzione del modello di device non trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  #   put:
  #     description: Aggiorna una funzione del modello di device specifica.
  #     tags:
  #       - device models
  #       - programming
  #       - device model functions
  #     requestBody:
  #       content:
  #         application/json:
  #           schema:
  #             $ref: "#/components/schemas/DeviceModelFunction"
  #     responses:
  #       "200":
  #         description: Funzione del modello di device aggiornata con successo.
  #         content:
  #           application/json:
  #             schema:
  #               type: object
  #               properties:
  #                 message:
  #                   type: string
  #                   description: Messaggio di successo
  #       "400":
  #         description: Errore nei parametri della richiesta.
  #         content:
  #           application/json:
  #             schema:
  #               $ref: "#/components/schemas/Error"
  #       "404":
  #         description: Funzione del modello di device non trovata.
  #         content:
  #           application/json:
  #             schema:
  #               $ref: "#/components/schemas/Error"
  #       default:
  #         $ref: "#/components/responses/InternalError"

  #   delete:
  #     tags:
  #       - device models
  #       - programming
  #       - device model functions
  #     responses:
  #       "200":
  #         description: Funzione del modello di device eliminata con successo.
  #         content:
  #           application/json:
  #             schema:
  #               type: object
  #               properties:
  #                 message:
  #                   type: string
  #                   description: Messaggio di successo
  #       "404":
  #         description: Funzione del modello di device non trovata.
  #         content:
  #           application/json:
  #             schema:
  #               $ref: "#/components/schemas/Error"
  #       default:
  #         $ref: "#/components/responses/InternalError"

  # ? /device_models/{deviceModelId}/functions/{deviceModelFunctionId}/properties/{propertyId}
  # : delete:
  #     tags:
  #       - device models
  #       - programming
  #       - device model functions
  #     parameters:
  #       - name: deviceModelId
  #         in: path
  #         description: ID del modello di device
  #         required: true
  #         schema:
  #           type: integer
  #       - name: deviceModelFunctionId
  #         in: path
  #         description: ID della funzione del modello di device
  #         required: true
  #         schema:
  #           type: integer
  #       - name: propertyId
  #         in: path
  #         description: ID della proprietà della funzione del modello di device
  #         required: true
  #         schema:
  #           type: integer
  #     responses:
  #       "200":
  #         description: Proprietà della funzione del modello di device eliminata con successo.
  #         content:
  #           application/json:
  #             schema:
  #               type: object
  #               properties:
  #                 message:
  #                   type: string
  #                   description: Messaggio di successo
  #       "404":
  #         description: Proprietà della funzione del modello di device non trovata.
  #         content:
  #           application/json:
  #             schema:
  #               $ref: "#/components/schemas/Error"
  #       default:
  #         $ref: "#/components/responses/InternalError"

  /devices/{deviceId}/functions:
    parameters:
      - name: deviceId
        in: path
        description: ID del device
        required: true
        schema:
          type: integer
    get:
      description: >
        Ritorna un elenco di tutte le funzioni aggiunte al device.
      tags:
        - devices
        - programming
        - device functions
      responses:
        "200":
          description: Lista di funzioni del device.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeviceFunction"
        "404":
          description: Device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"
    post:
      description: >
        Aggiunge una nuova funzione al device, data una funzione del modello di device.
      tags:
        - devices
        - programming
        - device functions
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                device_model_function_id:
                  type: integer
                  description: ID della funzione del modello di device
                enabled:
                  type: boolean
                  description: Se la funzione è abilitata
                  default: true
                parameters:
                  description: Parametri della funzione del device
                  type: array
                  items:
                    type: object
                    properties:
                      property_id:
                        type: string
                        description: ID del parametro della funzione del modello di device al quale si vuole associare un valore
                      value:
                        type: string
                        description: Valore del parametro
                inputs:
                  description: Inputs della funzione del device
                  type: array
                  items:
                    type: object
                    properties:
                      property_id:
                        type: string
                        description: ID dell'input della funzione del modello di device al quale si vuole associare un valore
                      value:
                        type: string
                        description: Valore dell'input
                outputs:
                  description: Outputs della funzione del device
                  type: array
                  items:
                    type: object
                    properties:
                      property_id:
                        type: string
                        description: ID dell'output della funzione del modello di device al quale si vuole associare un valore
                      value:
                        type: string
                        description: Valore dell'output
                notifications:
                  description: Notifiche della funzione del device
                  type: array
                  items:
                    type: object
                    properties:
                      property_id:
                        type: string
                        description: ID della notifica della funzione del modello di device al quale si vuole associare un valore
                      value:
                        type: string
                        description: Valore della notifica
              required:
                - device_model_function_id

      responses:
        "200":
          description: Funzione del device aggiunta con successo.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceFunction"
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Device o un'altra risorsa non trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /devices/{deviceId}/functions/{deviceFunctionId}:
    parameters:
      - name: deviceId
        in: path
        description: ID del device
        required: true
        schema:
          type: integer
      - name: deviceFunctionId
        in: path
        description: ID della funzione del device
        required: true
        schema:
          type: integer
    get:
      description: >
        Ritorna una funzione specifica del device.
      tags:
        - devices
        - programming
        - device functions
      responses:
        "200":
          description: Funzione del device trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceFunction"
        "404":
          description: Funzione del device non trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"
    put:
      description: >
        Salva tutti i valori associati alla funzione del device.
      tags:
        - devices
        - programming
        - device functions
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeviceFunction"
      responses:
        "200":
          description: Funzione del device aggiornata con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "400":
          description: Errore nei parametri della richiesta.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Funzione del device non trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"
    delete:
      tags:
        - devices
        - programming
        - device functions
      responses:
        "200":
          description: Funzione del device eliminata con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Funzione del device non trovata.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"

  /devices/{deviceId}/functions/apply:
    post:
      description: >
        Applica le funzioni del device fisico utilizzando la rete DaaS per inviare i dati.
      tags:
        - devices
        - programming
        - device functions
      parameters:
        - name: deviceId
          in: path
          description: ID del device
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Funzioni del device applicate con successo.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Messaggio di successo
        "404":
          description: Device non trovato.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/InternalError"
#endregion Programming
